<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DeepSeek Wrapper - Debug</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
  <link rel="stylesheet" href="css/styles.css">
  <script src="js/main.js"></script>
  <script src="js/header.js"></script>
  <script src="js/footer.js"></script>
  <style>
    body {
      background: linear-gradient(135deg, #1f2937 0%, #000000 100%);
      color: #f9fafb;
    }
    .CodeMirror {
      height: 100% !important;
      background: #1f2937 !important;
      color: #f9fafb !important;
    }
    .response-area {
      background: #1f2937;
      border: 1px solid #4f46e5;
    }
  </style>
</head>
<body>
  <div id="header"></div>
  <main class="max-w-7xl mx-auto px-4 py-6">
    <h1 class="text-3xl font-bold mb-6 text-pink-400">Debug Tool</h1>
    
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 h-[70vh]">
      <!-- Code Editor Section -->
      <div class="bg-gray-800 rounded-lg shadow-lg overflow-hidden">
        <div class="p-4 bg-gray-900 border-b border-gray-700">
          <h2 class="text-xl font-bold text-pink-400">Code Editor</h2>
        </div>
        <textarea id="codeEditor" class="w-full h-full"></textarea>
      </div>
      
      <!-- AI Response Section -->
      <div class="response-area rounded-lg shadow-lg overflow-hidden flex flex-col">
        <div class="p-4 bg-gray-900 border-b border-gray-700">
          <h2 class="text-xl font-bold text-pink-400">AI Debug Analysis</h2>
        </div>
        <div id="aiResponse" class="p-4 overflow-y-auto flex-grow text-white"></div>
        <div class="p-4 border-t border-gray-700">
          <button id="analyzeBtn" class="bg-gradient-to-r from-purple-600 to-indigo-600 text-white px-4 py-2 rounded hover:from-purple-700 hover:to-indigo-700 transition">
            Analyze Code
          </button>
        </div>
      </div>
    </div>
  </main>

  <div id="footer"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize CodeMirror
      const editor = CodeMirror.fromTextArea(document.getElementById('codeEditor'), {
        mode: 'javascript',
        lineNumbers: true,
        theme: 'default',
        lineWrapping: true,
        autoCloseBrackets: true,
        matchBrackets: true
      });

      // Analyze button functionality
      document.getElementById('analyzeBtn').addEventListener('click', async function() {
        const code = editor.getValue();
        if (!code.trim()) {
          document.getElementById('aiResponse').innerHTML = '<p class="text-red-400">Please enter some code to analyze.</p>';
          return;
        }

        document.getElementById('aiResponse').innerHTML = '<p class="text-pink-400">Analyzing code...</p>';
        
        try {
          const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': 'Bearer sk-2132008bc86a4114a14aac1ab29119ad'
            },
            body: JSON.stringify({
              model: "deepseek-chat",
              messages: [
                {
                  role: "system",
                  content: "You are a code debugging assistant. Analyze the following code for errors, bugs, and potential improvements. Provide detailed explanations for any issues found and suggest fixes."
                },
                {
                  role: "user",
                  content: `Please analyze this JavaScript code for errors and bugs:\n\n${code}`
                }
              ],
              temperature: 0.7,
              max_tokens: 2000
            })
          });

          if (!response.ok) {
            throw new Error(`API request failed with status ${response.status}`);
          }

          const data = await response.json();
          const aiMessage = data.choices?.[0]?.message?.content || "No analysis available";
          
          // Format the response with proper styling
          document.getElementById('aiResponse').innerHTML = `
            <div class="prose prose-invert max-w-none">
              <h3 class="text-xl font-bold text-pink-400 mb-4">Debug Analysis Results</h3>
              <div class="space-y-4">${formatAiResponse(aiMessage)}</div>
            </div>
          `;
        } catch (error) {
          document.getElementById('aiResponse').innerHTML = `
            <div class="bg-red-900/30 p-4 rounded border border-red-500">
              <h3 class="text-lg font-bold text-red-400">Error</h3>
              <p class="text-white">Failed to analyze code: ${error.message}</p>
              <p class="text-white mt-2">Please check your API key and network connection.</p>
            </div>
          `;
          console.error('Debug error:', error);
        }
      });

      // Helper function to format AI response
      function formatAiResponse(text) {
        // Convert markdown-like formatting to HTML
        return text
          .replace(/\*\*(.*?)\*\*/g, '<strong class="text-pink-400">$1</strong>')
          .replace(/\*(.*?)\*/g, '<em>$1</em>')
          .replace(/`(.*?)`/g, '<code class="bg-gray-700 px-1 rounded">$1</code>')
          .replace(/\n\n/g, '</p><p>')
          .replace(/\n/g, '<br>');
      }
    });
  </script>
</body>
</html>